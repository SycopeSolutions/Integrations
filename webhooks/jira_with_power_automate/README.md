# Integrating Sycope with Jira Atlassian + Power Automate Using Webhooks

Below is a test example demonstrating how Sycope creates new Jira incidents as well as Jira comments. You can use the instructions below to configure the same setup. Incidents can be created automatically when an alert is triggered or manually via the context menu, as described further below.

Example view of the **IT Support** space showing multiple active incidents generated from **Sycope** alerts:

<img width="1911" height="1046" alt="image" src="https://github.com/user-attachments/assets/46f98a6c-cabc-4ae1-81e7-ac2ad9022945" />

**Example of Jira comments for a reoccurring issue:**  

Example view of a Jira incident with multiple comments representing new alerts for the same issue, demonstrating how duplicate incidents are avoided.

<img width="1919" height="1167" alt="image" src="https://github.com/user-attachments/assets/0dd48e1f-6e73-4147-80ec-aee5c62cc32d" />

## Prerequirements

The following steps have been verified and are fully supported in the following environment:

- **Sycope** version 3.2 or later
- **Atlassian Jira Free** (supports up to 10 users or 3 agents) or higher
- **Microsoft 365 Business Basic** or higher, with the **Power Automate Premium** add-on (starting at €14 per month)

## Step-by-Step Guide

### Initial setup in Jira

First, please create a new IT Service Management Space, or another Space with a similar configuration.
Available Spaces can be accessed here: `https://YOUR_NAME.atlassian.net/jira/for-you`

<img width="1448" height="596" alt="image" src="https://github.com/user-attachments/assets/02b9329e-d156-4b68-ab6d-e40e280b750c" />

The new Space should be visible in your Jira Service Desk projects. In our example, we used “IT Support” and “HelpDesk”.
Defined Spaces can be accessed here: `https://YOUR_NAME.atlassian.net/jira/projects`

<img width="1507" height="600" alt="image" src="https://github.com/user-attachments/assets/b6e31691-d71b-4ba1-997e-40bfb4c2939f" />

Next, navigate to your Atlassian profile, go to **Security**, and create a new API token.
API tokens can be managed and created here: [https://id.atlassian.com/manage-profile/security/api-tokens](https://id.atlassian.com/manage-profile/security/api-tokens)

<img width="1038" height="365" alt="image" src="https://github.com/user-attachments/assets/1505eca6-ebbd-473d-903a-d24dc07bb458" />

Now you can communicate with the Jira API using your email address as the **username** and the API token as the **password**.
Use **Basic Auth** for authentication.

Send an HTTPS `GET` request to your projects URL, which should look like this:

`https://YOUR_NAME.atlassian.net/rest/api/3/project`

You can use below **curl** command, **Postman** or any other HTTP client to send the request. 

**Important:** Use **Basic Authentication** with:
- **Username:** your Jira email address
- **Password:** your Jira API token

        curl -X GET \
        https://YOUR_NAME.atlassian.net/rest/api/3/project \
        -H "Accept: application/json" \
        -u "EMAIL:API_TOKEN"

To create new incidents in your **IT Support** project, you need to identify the `"key"` value from the output above.
It should look similar to the following:

        "id": "10034", <<<<<--------
        "key": "IT",
        "name": "IT Support",

Next, create custom fields for `clientIp` and `serverIp` in Jira. These fields allow comparison of `alertName`, `clientIp`, and `serverIp` received from Sycope active alerts — the primary criteria for identifying potential duplicate incidents. When a duplicate is detected, the alert is added as a comment to the existing incident instead of creating a new one.  

Depending on your requirements, you may also consider adding additional fields to further refine duplicate detection.

To access the custom fields in Jira, navigate to:

**Settings → Work items** while on `https://your_name.atlassian.net/jira/for-you`

**OR** use the direct link: `https://your_name.atlassian.net/jira/settings/issues/fields`

<img width="513" height="414" alt="image" src="https://github.com/user-attachments/assets/a601da16-12dd-423b-933b-52038a5ce59a" />

Next, navigate to **Fields** and create the following custom fields using **Create new field** button:

1. **Client IP Field**
   - **Field type:** Short text (plain text only)  
   - **Name:** `clientIp`

2. **Server IP Field**
   - **Field type:** Short text (plain text only)  
   - **Name:** `serverIp`

You can verify the newly created fields by searching for `"ip"` in the Fields list.

<img width="803" height="450" alt="image" src="https://github.com/user-attachments/assets/c8c7f035-6510-4624-a3a5-0282832d38ec" />

Next, we need to retrieve the **ID** of the newly created fields.  
Jira API does not recognize the custom field names directly and requires their autogenerated **ID** values.  

To do this, send an HTTPS `GET` request to the Jira fields endpoint, which typically looks like this:

`https://your_name.atlassian.net/rest/api/3/field`

Example using **curl** command:

        curl -X GET \
        https://YOUR_NAME.atlassian.net/rest/api/3/field \
        -H "Accept: application/json" \
        -u "EMAIL:API_TOKEN"

After retrieving the list of fields from the Jira API, locate and copy the **IDs** for `clientIp` and `serverIp`.  

The **IDs** will look similar to the following example - `customfield_10091` for `clientIp`:

    {
        "id": "customfield_10091", <<<<<--------
        "key": "customfield_10091",
        "name": "clientIp",
        "untranslatedName": "clientIp",
        "custom": true,
        "orderable": true,
        "navigable": true,
        "searchable": true,
        "clauseNames": [
            "cf[10091]",
            "clientIp[Short text]",
            "clientIp"
        ],
        "schema": {
            "type": "string",
            "custom": "com.atlassian.jira.plugin.system.customfieldtypes:textfield",
            "customId": 10091
        }
    }

### Initial setup in Microsoft Power Automate

Next, create a new **webhook** in **Microsoft Power Automate**.  
This webhook will receive alerts from Sycope and determine whether to create a new incident in Jira or add a comment to an existing one.  

You can configure this webhook at:
[https://make.powerautomate.com/](https://make.powerautomate.com/)

In the **My flows** tab, click **New flow** and select **Instant cloud flow**.  
From the available flow's triggers, search for the **When an HTTP request is received** and define a new name of your **flow**.

<img width="825" height="528" alt="image" src="https://github.com/user-attachments/assets/d559a233-d425-4a2e-b3ec-f9bdc49063ab" />

In the next step, you will be redirected to the **Edit** view of your newly created flow. Click on the trigger labeled **Manual**.  

From this section, you can restrict which accounts are permitted to trigger the webhook.  

For testing purposes, we will leave this option set to **Anyone**.

<img width="1074" height="560" alt="image" src="https://github.com/user-attachments/assets/8036b930-13f6-46bc-b918-3e7188eeba8c" />

To generate the webhook URL, you must first save the flow. Power Automate requires at least one action to be defined before a flow can be saved.  

Since we are not yet ready to configure the main actions, add a temporary placeholder action:
1. Click the **+** button
2. From **Built-in** tools, select **Date Time**
3. Choose **Current time**

This will allow you to save the flow. Once saved, click the first trigger (**Manual**) to view the generated **HTTP URL**.  

Please copy this URL to your Notepad, as it will be required later to create a new Sycope integration.

<img width="738" height="549" alt="image" src="https://github.com/user-attachments/assets/8dc496ce-3c38-4177-8dea-ebca1ec0fc92" />

### Initial Integration setup in Sycope

Next, we need to provide a JSON example from Sycope so that Power Automate has a reference point for parsing it.

Log in to Sycope and create a new integration by navigating to:  

**Settings → General → Integrations → External Destinations**  

Then click **Add External Destination**.

It is necessary to split the Webhook URL into individual query parameters.  

You can do this automatically using **Postman** or another tool, or manually using the example below.

Our test URL is https://xxxxxxxxxxx.dc.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/xxxxxxxxxx/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=xxxxxxx

Main parameters:
- **Name:** As per your requirements
- **URL Protocol:** HTTPS
- **URL Host:** `xxxxxxxxxxx.dc.environment.api.powerplatform.com`
- **URL Port:** 443
- **Method:** POST
- **Path:** /powerautomate/automations/direct/workflows/xxxxxxxxxx/triggers/manual/paths/invoke

Query params:
- **api-version:** 1
- **sp:** /triggers/manual/run
- **sv:** 1.0
- **sig:** xxxxxxx

The final result should appear as shown below:

<img width="683" height="893" alt="image" src="https://github.com/user-attachments/assets/5552e9de-95f9-45ef-88eb-a5a9bfeb4c2a" />

There is no need to edit other tabs and your new Integration can now be saved.

Next, select any active alert from the **Alerts** view and right-click its name.  

Choose: **Send externally → REST Client → YOUR_INTEGRATION_NAME**.  

A **Success** message should appear in the bottom-right corner.

<img width="1202" height="520" alt="image" src="https://github.com/user-attachments/assets/c2445dba-7378-4bdf-8b11-acc25f6ec47e" />

### Expanding Power Automate flow configuration

Now, return to **Microsoft Power Automate** and click the **Back** button.  

You should see a **Succeeded** status for the manual action from Sycope, indicating that the webhook has successfully received the manual action.

<img width="1099" height="610" alt="image" src="https://github.com/user-attachments/assets/2d882788-4cac-4d9b-bafc-b716f6dc1123" />

Click on the **Start date** to analyze our test.  

First, select **manual**, then choose **Show raw output** under **OUTPUTS**

<img width="873" height="458" alt="image" src="https://github.com/user-attachments/assets/741d2bc4-4999-4c00-8d5d-7aaffd6166f8" />

The output should look similar to the example below, but much longer. Please copy all the text into **Notepad**.

<img width="569" height="232" alt="image" src="https://github.com/user-attachments/assets/bbd39270-ff76-42da-8e18-c9aae0cb0672" />

Next, exit the test by returning to your flow and clicking **Edit**.  

We now need to modify the flow to handle Sycope alerts in **JSON** format, using the example we just sent.

Click the first **+** sign and select the **Parse JSON** action. I have renamed it to "Parse JSON from Sycope".

<img width="870" height="280" alt="image" src="https://github.com/user-attachments/assets/45dbfe9a-eb17-4092-86e7-53fb0408d890" />

Click the **Parse JSON from Sycope** action, then select **Use sample payload to generate schema** and paste the entire JSON alert from your Notepad.

<img width="787" height="351" alt="image" src="https://github.com/user-attachments/assets/72569502-3937-41d8-a32b-2d4edd4e3e8c" />

The final result should appear similar to the example below.  

You will notice that Power Automate has automatically generated the schema.

<img width="877" height="622" alt="image" src="https://github.com/user-attachments/assets/8cb1ee1c-9699-4aa8-be37-46ebb04df38d" />

For **Content**, click on the **lightning** symbol...

<img width="575" height="231" alt="image" src="https://github.com/user-attachments/assets/c95c2dd9-f63c-4215-a79a-2ad846c8d606" />

...and select **Body** from your **manual** trigger, which I called **When Webhook received Alert from Sycope**.

<img width="556" height="461" alt="image" src="https://github.com/user-attachments/assets/2b668beb-1b8d-4820-a0d4-789d5a9455dd" />

We are now ready to add an action that will gather all currently open Jira incidents. This list will be used to compare against alerts received from Sycope.  

Click the last **+** sign and search for the **HTTP** action.

<img width="871" height="377" alt="image" src="https://github.com/user-attachments/assets/731eff2d-d228-4aae-a46f-b2104bb53cef" />

We have renamed this action to **Parse JSON from Sycope**.  

- **URI:** `https://YOUR_NAME.atlassian.net/rest/api/3/search/jql`  
- **Method:** `POST`  

For the **Body**, use our template:  
[https://github.com/SycopeSolutions/Integrations/blob/main/webhooks/jira_with_power_automate/get_jira_issues.json](https://github.com/SycopeSolutions/Integrations/blob/main/webhooks/jira_with_power_automate/get_jira_issues.json)  

> **Note:** The template requires the following modifications:  
> 1. Replace the **project key** with your own (in our example, it is `"IT"`).  
> 2. Update the two **customfield IDs** as needed.  

We have included several **if statements** to compare the alert's `name`, `clientIp`, and `serverIp` with currently open Jira incidents. You can adjust the number of fields used for comparison depending on your requirements.

<img width="872" height="734" alt="image" src="https://github.com/user-attachments/assets/e96ac096-f62d-48a8-ab87-084173c7cc09" />

We also need to configure **Authentication** in the **Advanced parameters** section and save all changes:

- **Authentication type:** Basic  
- **Username:** your Jira email address  
- **Password:** your Jira API token

<img width="551" height="331" alt="image" src="https://github.com/user-attachments/assets/ba0aa89b-caff-42ea-b1e1-74cbe8d36395" />

Next, we need to prepare JSON parsing for the Jira response, similar to how we did for the Sycope alert.  

You can use **curl** or **Postman** to retrieve open Jira incidents. Below is a sample **curl** command you can use, or you may use Postman if preferred.
> **Note:**  
> Please ensure that at least one Jira incident is currently open. If none exist, create a test incident before proceeding.

        curl -X POST \
          -H "Content-Type: application/json" \
          -u "YOUR_EMAIL:YOUR_API_TOKEN" \
          -d '{
            "jql": "project = IT AND statusCategory != Done",
            "fields": ["summary", "assignee", "status", "created", "customfield_10091", "customfield_10092"],
            "maxResults": 1
          }' \
          https://YOUR_NAME.atlassian.net/rest/api/3/search/jql

The output should appear similar to the example below.  

Please copy it into **Notepad** for reference.

<img width="922" height="310" alt="image" src="https://github.com/user-attachments/assets/d08e706f-73c4-4f2b-a620-46150389f0d0" />

Next, add a new **Parse JSON** action at the end of the flow.

<img width="1020" height="509" alt="image" src="https://github.com/user-attachments/assets/3c24fd16-1008-43ef-886f-5434c327bf91" />

For **Content**, select **Body** from the **Get Jira Issues** action using the **lightning** option.  

Then, use the copied JSON in **Use sample payload to generate schema** to generate the schema automatically.

<img width="1014" height="423" alt="image" src="https://github.com/user-attachments/assets/c2132cee-4f80-4aa1-ad41-d17e76f6ca52" />

I have also renamed the new action to **Parse JSON for Jira Issues**.  

The final result should appear as shown below. You can now save the flow.

<img width="1023" height="617" alt="image" src="https://github.com/user-attachments/assets/906049e6-bfef-464b-91a2-ae2f4f8d5765" />

We are now ready to add a new **Condition**, which will determine whether to create a new incident or add a comment to an existing one.

<img width="1019" height="580" alt="image" src="https://github.com/user-attachments/assets/c4eee8b5-935d-41e8-8b0d-eda2f93a377f" />

Once the **Condition** is added, click on its name.  

Go to the first condition expression and select **Function**.

<img width="1021" height="467" alt="image" src="https://github.com/user-attachments/assets/d82d8096-8ec1-4bf8-a2ee-6d43b070ccb3" />

Add the following function into the window and click **Add**:

        length(body('Parse_JSON_for_Jira_Issues')?['issues'])

<img width="679" height="169" alt="image" src="https://github.com/user-attachments/assets/a5562447-f187-4429-8f36-b9360bf72601" />

Power Automate should recognize the function.  

You can now select **greater than** and set the value to `0`.  

This means the **Condition** will evaluate to **True** if at least one Jira incident exists with the same **Alert name**, **clientIp**, and **serverIp**.

<img width="545" height="281" alt="image" src="https://github.com/user-attachments/assets/ad753665-207d-43c7-a0d2-0ea03fa18619" />

Next, add an **Apply to each** action in the **True** branch of the condition.  

This serves as a safeguard against duplicate Jira incidents. While duplicates should not occur, this setup ensures that a comment is added to every matching incident if necessary. Alternatively, you can modify the flow to only use the first incident by applying the `maxResults: 1` filter in the **Get Jira Issues** action.

<img width="957" height="388" alt="image" src="https://github.com/user-attachments/assets/12c66626-d7ef-41f5-9139-24083abc57fa" />

In the **Select an output from previous step** field, choose `Body → issues` from the **Parse JSON for Jira Issues** action.

<img width="1020" height="373" alt="image" src="https://github.com/user-attachments/assets/fd1a823e-aeb3-4354-bb04-01519c768618" />

We now have the data available to operate within the **Apply to each** block.  

Next, add the **HTTP** actions inside this block.

<img width="935" height="323" alt="image" src="https://github.com/user-attachments/assets/b8fe67a0-b8ff-45ba-ba5c-d3e05e468f21" />

Configure the **HTTP** action inside the **Apply to each** block using the following parameters:

- **Name:** Create Jira comment  
- **URI:** `https://YOUR_NAME.atlassian.net/rest/api/3/issue/@{items('Apply_to_each')?['key']}/comment`  
- **Method:** POST  
- **Body:** Use the example from our repository: [create_jira_comment.json](https://github.com/SycopeSolutions/Integrations/blob/main/webhooks/jira_with_power_automate/create_jira_comment.json)  
  > **Note:** Replace `SYCOPE_IP` with your Sycope IP address or DNS record.

Also, configure **Authentication** in the **Advanced parameters** section and save all changes:  

- **Authentication type:** Basic  
- **Username:** your Jira email address  
- **Password:** your Jira API token

<img width="999" height="566" alt="image" src="https://github.com/user-attachments/assets/c80f92b7-117e-4a12-87ae-83a6fbf4ca7b" />

Next, add the main **HTTP** action to create a new Jira incident.  

This action should be placed in the **False** branch of the condition, meaning no existing open incidents were found for the alert.

<img width="943" height="347" alt="image" src="https://github.com/user-attachments/assets/9f8c29f4-378d-421d-8ca9-47096180873d" />

Please use below parameters:

- **Name:** Open new Jira incident
- **URI:** `https://YOUR_NAME.atlassian.net/rest/api/3/issue/@{items('Apply_to_each')?['key']}/comment`  
- **Method:** POST  
- **Body:** Use the example from our repository: [new_jira_incident.json](https://github.com/SycopeSolutions/Integrations/blob/main/webhooks/jira_with_power_automate/new_jira_incident.json))  
> **Note:** Replace `SYCOPE_IP` with your Sycope IP address or DNS record, and update `"key": "IT"` with your Jira project key.

Also, configure **Authentication** in the **Advanced parameters** section and save all changes:  

- **Authentication type:** Basic  
- **Username:** your Jira email address  
- **Password:** your Jira API token

<img width="1024" height="588" alt="image" src="https://github.com/user-attachments/assets/426bf50d-28c4-4d2c-8a50-95602668497d" />

You can now remove the temporary **Current time** action, as it is no longer needed.

<img width="901" height="191" alt="image" src="https://github.com/user-attachments/assets/d7a5be8a-2606-4b4c-a154-15da3307c898" />

The final flow should look as shown below.  

Please ensure that you have **saved** all changes before proceeding.

<img width="531" height="785" alt="image" src="https://github.com/user-attachments/assets/27fe6d6c-4f9c-473d-ac58-ecb40534da9b" />

### Final Words

You have now completed the setup! Your **External Destinations** can be used manually from the Alerts dashboard or added to an existing rule to trigger automatically when an alert occurs.

To execute these actions automatically, navigate to **Configuration → Rules** and edit the desired rule.  

Under **Actions**, configure the following:

- **Type:** Third-party system (REST)  
- **External system:** REST  
- **Instance name:** `YOUR_NAME`  
- **Threshold levels:** Select the severity levels that should trigger this action  

The final configuration should appear as shown below:

<img width="1899" height="1029" alt="image" src="https://github.com/user-attachments/assets/8645de39-e5e7-4815-b3a6-6824c391dcbc" />
